<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• 100 Day Glow Up</title>

<style>
body{
  margin:0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:white;
  text-align:center;
}

.container{
  max-width:500px;
  margin:auto;
  padding:20px;
}

.card{
  background:rgba(255,255,255,0.05);
  padding:20px;
  border-radius:20px;
  backdrop-filter: blur(10px);
  margin-top:20px;
}

input,select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:10px;
  font-size:16px;
}

button{
  background:#ff2e63;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

progress{
  width:100%;
  height:15px;
}

h1{color:#ff2e63;}
.level{color:#00f5d4;font-weight:bold;}
</style>
</head>

<body>

<div class="container">

<h1>üî• 100 Day Glow Up</h1>

<!-- ONBOARDING -->
<div id="setup" class="card">
<h2>Start Your Journey</h2>
<input id="name" placeholder="Your Name">
<input id="age" placeholder="Your Age" type="number">

<select id="goal">
<option value="weight loss">Weight Loss</option>
<option value="muscle gain">Muscle Gain</option>
<option value="healthy lifestyle">Healthy Lifestyle</option>
<option value="productivity">Productivity</option>
</select>

<select id="personality">
<option value="hardcore">Hardcore üî•</option>
<option value="balanced">Balanced ‚öñÔ∏è</option>
<option value="chill">Chill üåø</option>
</select>

<button onclick="startApp()">Start 100 Days</button>
</div>

<!-- APP -->
<div id="app" style="display:none;" class="card">

<h2 id="welcome"></h2>

<p id="day"></p>
<p id="streak"></p>
<p class="level" id="level"></p>
<p id="xp"></p>

<progress id="progressBar" max="100" value="1"></progress>

<h3>Today's Plan</h3>
<p id="task"></p>

<button onclick="completeDay()">Complete Day ‚úÖ</button>
<button onclick="shareProgress()">Share Progress üì§</button>
<button onclick="askAI()">Ask AI Assistant ü§ñ</button>

<div id="aiResponse" style="margin-top:15px;"></div>

</div>
</div>

<script>

function getData(){
  let data=JSON.parse(localStorage.getItem("glowApp"));
  if(!data){
    data={
      name:"",
      age:"",
      goal:"",
      personality:"",
      day:1,
      streak:0,
      xp:0,
      level:1,
      lastComplete:0
    };
  }
  return data;
}

function saveData(data){
  localStorage.setItem("glowApp",JSON.stringify(data));
}

function startApp(){
  let data=getData();
  data.name=document.getElementById("name").value;
  data.age=document.getElementById("age").value;
  data.goal=document.getElementById("goal").value;
  data.personality=document.getElementById("personality").value;

  saveData(data);

  document.getElementById("setup").style.display="none";
  document.getElementById("app").style.display="block";

  loadApp();
  generatePlan();
}

function loadApp(){
  let data=getData();

  document.getElementById("welcome").innerText=
    `Welcome ${data.name} üî•`;

  document.getElementById("day").innerText=
    `Day ${data.day}/100`;

  document.getElementById("streak").innerText=
    `üî• Streak: ${data.streak}`;

  document.getElementById("xp").innerText=
    `XP: ${data.xp}`;

  document.getElementById("level").innerText=
    `Level ${data.level}`;

  document.getElementById("progressBar").value=data.day;
}

async function generatePlan(){
  let data=getData();

  const res=await fetch("/.netlify/functions/ai",{
    method:"POST",
    body:JSON.stringify({
      type:"plan",
      name:data.name,
      age:data.age,
      goal:data.goal,
      personality:data.personality,
      day:data.day
    })
  });

  const result=await res.json();
  document.getElementById("task").innerText=result.reply;
}

function completeDay(){
  let data=getData();

  const now=Date.now();
  const diff=now-data.lastComplete;

  if(diff<86400000){
    alert("Come back tomorrow üî•");
    return;
  }

  if(diff>172800000) data.streak=0;

  data.day++;
  data.streak++;
  data.xp+=50;

  if(data.xp>=data.level*200){
    data.level++;
  }

  data.lastComplete=now;

  saveData(data);
  loadApp();
  generatePlan();
}

function shareProgress(){
  let data=getData();
  const text=`üî• I am on Day ${data.day} of my 100 Day ${data.goal} Challenge! Level ${data.level}!`;

  if(navigator.share){
    navigator.share({text});
  }else{
    alert(text);
  }
}

async function askAI(){
  let question=prompt("Ask your AI Coach anything:");

  if(!question) return;

  const res=await fetch("/.netlify/functions/ai",{
    method:"POST",
    body:JSON.stringify({
      type:"assistant",
      question:question
    })
  });

  const result=await res.json();
  document.getElementById("aiResponse").innerText=result.reply;
}

if(localStorage.getItem("glowApp")){
  document.getElementById("setup").style.display="none";
  document.getElementById("app").style.display="block";
  loadApp();
  generatePlan();
}

</script>
</body>
</html>
