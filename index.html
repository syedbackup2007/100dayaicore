<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üî• 100 Day AI Transformation</title>

<style>
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);
  color:white;
  text-align:center;
}

.container{
  max-width:520px;
  margin:auto;
  padding:20px;
}

.card{
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(12px);
  padding:20px;
  border-radius:20px;
  margin-top:20px;
}

input,select,button{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:none;
  font-size:16px;
}

button{
  background:#ff2e63;
  color:white;
  font-weight:bold;
  cursor:pointer;
}

button:hover{
  opacity:0.9;
}

progress{
  width:100%;
  height:16px;
  border-radius:20px;
}

.level{
  color:#00f5d4;
  font-weight:bold;
}

canvas{
  margin-top:15px;
  border-radius:20px;
}
</style>
</head>

<body>

<div class="container">

<h1>üî• 100 Day Transformation</h1>

<!-- SETUP -->
<div id="setup" class="card">
<input id="name" placeholder="Your Name">
<input id="age" type="number" placeholder="Your Age">

<select id="goal">
<option value="weight loss">Weight Loss</option>
<option value="muscle gain">Muscle Gain</option>
<option value="healthy lifestyle">Healthy Lifestyle</option>
<option value="productivity">Productivity</option>
</select>

<select id="personality">
<option value="hardcore">Hardcore üî•</option>
<option value="balanced">Balanced ‚öñÔ∏è</option>
<option value="chill">Chill üåø</option>
</select>

<button onclick="startApp()">Start Challenge</button>
</div>

<!-- APP -->
<div id="app" class="card" style="display:none">

<h2 id="welcome"></h2>

<p id="day"></p>
<p id="streak"></p>
<p id="xp"></p>
<p class="level" id="level"></p>

<progress id="progressBar" max="100" value="1"></progress>

<h3>üéØ Daily Task</h3>
<p id="dailyTask"></p>

<button onclick="completeDay()">Complete Day ‚úÖ</button>
<button onclick="generateShareImage()">Share Progress üì∏</button>
<button onclick="askAI()">Ask AI Coach ü§ñ</button>

<div id="aiResponse" style="margin-top:15px;"></div>
<canvas id="shareCanvas" width="400" height="400"></canvas>

</div>
</div>

<script>

function getData(){
  let data=JSON.parse(localStorage.getItem("transformApp"));
  if(!data){
    data={
      name:"",
      age:"",
      goal:"",
      personality:"",
      day:1,
      streak:0,
      xp:0,
      level:1,
      lastComplete:0
    };
  }
  return data;
}

function saveData(data){
  localStorage.setItem("transformApp",JSON.stringify(data));
}

function startApp(){
  let data=getData();
  data.name=name.value;
  data.age=age.value;
  data.goal=goal.value;
  data.personality=personality.value;
  saveData(data);

  setup.style.display="none";
  app.style.display="block";

  loadApp();
  generateDailyTask();
}

function loadApp(){
  let data=getData();
  welcome.innerText=`Welcome ${data.name} üî•`;
  day.innerText=`Day ${data.day}/100`;
  streak.innerText=`üî• Streak: ${data.streak}`;
  xp.innerText=`XP: ${data.xp}`;
  level.innerText=`Level ${data.level}`;
  progressBar.value=data.day;
}

async function generateDailyTask(){
  let data=getData();

  const res=await fetch("/.netlify/functions/ai",{
    method:"POST",
    body:JSON.stringify({
      type:"daily",
      name:data.name,
      age:data.age,
      goal:data.goal,
      personality:data.personality,
      day:data.day
    })
  });

  const result=await res.json();
  dailyTask.innerText=result.reply;
}

function completeDay(){
  let data=getData();
  const now=Date.now();
  const diff=now-data.lastComplete;

  if(diff<86400000){
    alert("Come back tomorrow üî•");
    return;
  }

  if(diff>172800000) data.streak=0;

  data.day++;
  data.streak++;
  data.xp+=50;

  if(data.xp>=data.level*200){
    data.level++;
  }

  data.lastComplete=now;

  saveData(data);
  loadApp();
  generateDailyTask();
}

async function askAI(){
  let question=prompt("Ask your AI Coach:");

  if(!question) return;

  let data=getData();

  const res=await fetch("/.netlify/functions/ai",{
    method:"POST",
    body:JSON.stringify({
      type:"assistant",
      question:question,
      goal:data.goal,
      personality:data.personality
    })
  });

  const result=await res.json();
  aiResponse.innerText=result.reply;
}

function generateShareImage(){
  let data=getData();
  const canvas=document.getElementById("shareCanvas");
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="#0f0c29";
  ctx.fillRect(0,0,400,400);

  ctx.fillStyle="#ff2e63";
  ctx.font="bold 26px Poppins";
  ctx.fillText("üî• 100 Day Challenge",50,60);

  ctx.fillStyle="white";
  ctx.font="20px Poppins";
  ctx.fillText(`Name: ${data.name}`,50,120);
  ctx.fillText(`Goal: ${data.goal}`,50,160);
  ctx.fillText(`Day: ${data.day}`,50,200);
  ctx.fillText(`Level: ${data.level}`,50,240);
  ctx.fillText(`Streak: ${data.streak}`,50,280);

  const image=canvas.toDataURL("image/png");

  const link=document.createElement("a");
  link.href=image;
  link.download="progress.png";
  link.click();
}

if(localStorage.getItem("transformApp")){
  setup.style.display="none";
  app.style.display="block";
  loadApp();
  generateDailyTask();
}

</script>
</body>
</html>
